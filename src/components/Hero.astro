---
import { Image } from "astro:assets";
import leftLeafImage from "../public/images/hero-left-leaf.png";
import rightLeafImage from "../public/images/hero-right-leaf.png";
---

<section id="hero" class="noisy">
  <h1 class="title">Paloma</h1>
  <Image src={leftLeafImage} alt="left-leaf" class="left-leaf" />
  <Image src={rightLeafImage} alt="right-leaf" class="right-leaf" />
  <div class="body">
    <div class="content">
      <div class="space-y-5 hidden md:block">
        <p>Cool. Crisp. Classic.</p>
        <p class="subtitle">
          Sip the Spirit <br /> of Summer
        </p>
      </div>
      <div class="view-cocktails">
        <p class="subtitle">
          Every cocktail on our menu is a blend of premium ingredients, creative
          flair, and timeless recipes â€” designed to delight your senses.
        </p>
        <a href="#cocktails">View Cocktails</a>
      </div>
    </div>
  </div>
</section>

<script>
  import { gsap } from "gsap";
  import { SplitText } from "gsap/SplitText";
  import { ScrollTrigger } from "gsap/ScrollTrigger";

  gsap.registerPlugin(SplitText, ScrollTrigger);

  // Use a more robust approach for Astro
  function initAnimations() {
    const heroSplitText = new SplitText(".title", {
      type: "chars, words",
    });

    const paragraphSplitText = new SplitText(".subtitle", {
      type: "lines",
    });

    heroSplitText.chars.forEach((char) => char.classList.add("text-gradient"));

    gsap.from(heroSplitText.chars, {
      yPercent: 100,
      duration: 1.5,
      ease: "expo.out",
      stagger: 0.06,
    });

    gsap.from(paragraphSplitText.lines, {
      opacity: 0,
      yPercent: 100,
      duration: 1.8,
      ease: "expo.out",
      stagger: 0.06,
      delay: 0.1,
    });

    // Test if elements exist
    const leftLeaf = document.querySelector(".left-leaf");
    const rightLeaf = document.querySelector(".right-leaf");
    const hero = document.querySelector("#hero");

    console.log("Elements found:", { leftLeaf, rightLeaf, hero });

    if (leftLeaf && rightLeaf && hero) {
      console.log("All elements found, creating animation...");

      gsap
        .timeline({
          scrollTrigger: {
            trigger: "#hero",
            start: "top top",
            end: "bottom top",
            scrub: true,
            onUpdate: () => console.log("ScrollTrigger updating"),
            onToggle: (self) =>
              console.log("ScrollTrigger toggled:", self.isActive),
          },
        })
        .to(".right-leaf", { y: 200 }, 0)
        .to(".left-leaf", { y: -200 }, 0);
    } else {
      console.error("Missing elements for animation");
    }
  }

  // Try multiple approaches to ensure the script runs
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", initAnimations);
  } else {
    initAnimations();
  }
</script>
